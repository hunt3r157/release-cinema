name: release-cinema CI
on: [push, pull_request]
jobs:
  selftest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: 20 }
      - name: Install render tools
        run: sudo apt-get update && sudo apt-get install -y imagemagick ffmpeg fonts-dejavu-core
      - name: Create some fake commits (if shallow)
        run: |
          git fetch --unshallow || true
          git config user.email "ci@example.com"
          git config user.name "CI"
          echo "$(date)" >> .github/workflows/ci.yml
          git add .github/workflows/ci.yml && git commit -m "ci: touch"
      - name: Render sample
        run: |
          node bin/release-cinema.mjs render --auto --out-dir assets
          node bin/release-cinema.mjs simulate --out assets/cli_sim.gif
      - uses: actions/upload-artifact@v4
        with:
          name: sample-assets
          path: assets/*
